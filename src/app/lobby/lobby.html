<div class="min-h-screen w-full bg-slate-950 text-slate-100">
  <div class="max-w-5xl mx-auto flex flex-col lg:flex-row gap-8 items-start p-6">
    <aside class="w-full lg:w-72 flex flex-col gap-4">
      <h2 class="text-2xl font-semibold tracking-tight">Lobby</h2>

      <div *ngIf="user$ | async as user" class="text-xs text-slate-300 space-y-3">
        <div class="uppercase tracking-wide text-slate-500">Angemeldet</div>

        <div class="flex items-center gap-3 rounded-2xl border border-slate-800 bg-slate-900/40 px-3 py-3">
          <div
            class="h-11 w-11 rounded-2xl grid place-items-center text-lg font-bold
                   bg-slate-800/70 text-slate-100"
          >
            {{ user.username.charAt(0).toUpperCase() }}
          </div>
          <div class="flex-1">
            <div class="text-base font-semibold text-slate-100">
              {{ user.username }}
              <span class="text-slate-500 text-sm">#{{ user.publicId ?? user.id }}</span>
            </div>
            <div class="text-[0.7rem] uppercase tracking-[0.18em] text-slate-500">
              {{ user.isAdmin ? 'Admin' : 'Spieler' }}
            </div>
          </div>
          <span
            *ngIf="user.isAdmin"
            class="rounded-full border border-amber-400/70 bg-amber-500/10 px-2 py-0.5 text-[0.6rem]
                   uppercase tracking-[0.16em] text-amber-200"
          >
            Admin
          </span>
        </div>

        <div class="flex gap-2">
          <button
            type="button"
            (click)="goToLocal()"
            class="px-3 py-1 rounded-full border border-slate-600
                   bg-slate-900/90 text-[0.7rem] tracking-[0.16em] uppercase
                   hover:border-slate-300 transition"
          >
            Lokales Spiel
          </button>
          <button
            *ngIf="user.isAdmin"
            type="button"
            routerLink="/admin"
            class="px-3 py-1 rounded-full border border-amber-400/70
                   bg-amber-500/10 text-[0.7rem] tracking-[0.16em] uppercase
                   text-amber-200 hover:border-amber-300 transition"
          >
            Admin
          </button>
          <button
            type="button"
            (click)="logout()"
            class="px-3 py-1 rounded-full border border-rose-400/70
                   bg-slate-900/90 text-[0.7rem] tracking-[0.16em] uppercase
                   hover:bg-rose-500/15 hover:border-rose-200 transition"
          >
            Abmelden
          </button>
        </div>
      </div>
    </aside>

    <main class="flex-1 flex flex-col gap-6">
      <section class="rounded-2xl border border-slate-800 bg-slate-950/70 p-5">
        <div class="text-[0.7rem] uppercase tracking-wide text-slate-500">
          Spieler finden (ID oder Name)
        </div>
        <div class="mt-2 flex gap-2">
          <input
            class="w-full rounded-lg border border-slate-700 bg-slate-900/70 px-3 py-2 text-xs"
            [(ngModel)]="searchQuery"
            (ngModelChange)="onSearchChange()"
            placeholder="z.B. 12 oder spieler"
          />
        </div>

        <div class="mt-3 space-y-2 text-xs text-slate-300">
          <div *ngFor="let result of searchResults" class="flex items-center justify-between gap-2">
            <div>
              <span class="font-semibold">{{ result.username }}</span>
              <span class="text-slate-500">#{{ result.publicId ?? result.id }}</span>
            </div>
            <button
              type="button"
              (click)="invite(result)"
              class="px-2.5 py-1 rounded-full border border-emerald-500/70
                     text-[0.65rem] uppercase tracking-[0.16em]
                     hover:border-emerald-300 hover:bg-emerald-500/10 transition"
              [disabled]="busy"
            >
              Einladen
            </button>
          </div>
          <div *ngIf="searchResults.length === 0 && searchQuery">
            Keine Treffer.
          </div>
        </div>
      </section>

      <section class="rounded-2xl border border-slate-800 bg-slate-950/70 p-5">
        <div class="text-[0.7rem] uppercase tracking-wide text-slate-500">
          Aktive Einladungen
        </div>

        <div class="mt-3 space-y-2 text-xs text-slate-300">
          <ng-container *ngIf="user$ | async as user">
            <div
              *ngFor="let invite of invites"
              class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 rounded-xl border border-slate-800 bg-slate-900/40 px-3 py-2"
            >
              <div>
                <div class="text-sm font-semibold">
                  <span *ngIf="isIncoming(invite, user.id)">
                    Einladung von {{ invite.from_username }} #{{ invite.from_public_id ?? invite.from_user_id }}
                  </span>
                  <span *ngIf="!isIncoming(invite, user.id)">
                    Einladung an {{ invite.to_username }} #{{ invite.to_public_id ?? invite.to_user_id }}
                  </span>
                </div>
                <div class="text-[0.7rem] text-slate-500">
                  {{ invite.created_at | date:'shortTime' }}
                </div>
              </div>
              <div class="flex gap-2">
                <button
                  *ngIf="isIncoming(invite, user.id)"
                  type="button"
                  (click)="accept(invite)"
                  class="px-2.5 py-1 rounded-full border border-emerald-500/70
                         text-[0.65rem] uppercase tracking-[0.16em]
                         hover:border-emerald-300 hover:bg-emerald-500/10 transition"
                  [disabled]="busy"
                >
                  Annehmen
                </button>
                <button
                  *ngIf="!isIncoming(invite, user.id)"
                  type="button"
                  (click)="cancel(invite)"
                  class="px-2.5 py-1 rounded-full border border-rose-500/70
                         text-[0.65rem] uppercase tracking-[0.16em]
                         hover:border-rose-300 hover:bg-rose-500/10 transition"
                  [disabled]="busy"
                >
                  Abbrechen
                </button>
              </div>
            </div>
          </ng-container>

          <div *ngIf="invites.length === 0" class="text-slate-500">
            Keine aktiven Einladungen.
          </div>
        </div>
      </section>

      <section class="rounded-2xl border border-slate-800 bg-slate-950/70 p-5">
        <div class="text-[0.7rem] uppercase tracking-wide text-slate-500">
          Aktive Spiele
        </div>

        <div class="mt-3 space-y-2 text-xs text-slate-300">
          <ng-container *ngIf="user$ | async as user">
            <div
              *ngFor="let game of games"
              class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 rounded-xl border border-slate-800 bg-slate-900/40 px-3 py-2"
            >
              <div>
                <div class="text-sm font-semibold">
                  vs
                  <span *ngIf="game.host.id === user.id">{{ game.guest.username }}</span>
                  <span *ngIf="game.guest.id === user.id">{{ game.host.username }}</span>
                </div>
                <div class="text-[0.7rem] text-slate-500">
                  {{ game.updatedAt | date:'short' }}
                </div>
              </div>
              <div class="flex gap-2">
                <button
                  type="button"
                  (click)="deleteGame(game.id)"
                  class="px-2.5 py-1 rounded-full border border-rose-500/70
                         text-[0.65rem] uppercase tracking-[0.16em]
                         hover:border-rose-300 hover:bg-rose-500/10 transition"
                  [disabled]="busy"
                >
                  Löschen
                </button>
                <button
                  type="button"
                  (click)="openGame(game.id)"
                  class="px-2.5 py-1 rounded-full border border-emerald-500/70
                         text-[0.65rem] uppercase tracking-[0.16em]
                         hover:border-emerald-300 hover:bg-emerald-500/10 transition"
                  [disabled]="busy"
                >
                  Öffnen
                </button>
              </div>
            </div>
          </ng-container>

          <div *ngIf="games.length === 0" class="text-slate-500">
            Keine aktiven Spiele.
          </div>
        </div>
      </section>
    </main>
  </div>
</div>
